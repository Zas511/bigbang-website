<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BIG BANG - The Journey</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/ScrollTrigger.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        body {
            font-family: 'Almarai', sans-serif;
            background-color: #000;
            color: #fff;
            overflow-x: hidden;
        }
        .three-canvas {
            position: fixed;
            top: 0;
            left: 0;
            outline: none;
            z-index: -1;
        }
        .narrative-section {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            z-index: 1;
        }
        .content-box {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: 1rem;
            max-width: 600px;
            text-align: center;
        }
        /* New styles for the journey icons */
        .journey-icon {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            text-decoration: none;
            opacity: 0.5;
            transform: scale(1);
        }
        .journey-icon:hover {
            background-color: rgba(0, 169, 157, 0.8);
            transform: scale(1.1);
        }
        .journey-icon.active {
            opacity: 1;
            transform: scale(1.2);
            background-color: #00A99D;
            box-shadow: 0 0 15px #00A99D;
        }
    </style>
</head>
<body>
    <canvas class="three-canvas"></canvas>

    <div id="journey-icons-container" class="fixed left-4 top-1/2 -translate-y-1/2 flex flex-col gap-4 z-10 opacity-0 transition-opacity duration-1000">
        <a href="#city-section" id="icon-city" class="journey-icon" title="المدينة"><i class="fas fa-city fa-lg"></i></a>
        <a href="#forest-section" id="icon-forest" class="journey-icon" title="الغابة"><i class="fas fa-tree fa-lg"></i></a>
        <a href="#snow-section" id="icon-snow" class="journey-icon" title="الثلج"><i class="fas fa-snowflake fa-lg"></i></a>
        <a href="#desert-section" id="icon-desert" class="journey-icon" title="الصحراء"><i class="fas fa-dune fa-lg"></i></a>
    </div>

    <div class="main-content">
        <section id="big-bang-section" class="narrative-section">
            <div class="content-box">
                <h1 class="text-5xl font-extrabold">الانفجار العظيم</h1>
                <p class="mt-4">كل رحلة عظيمة تبدأ بلحظة... مرر للأسفل لبدء رحلتك.</p>
            </div>
        </section>

        <section id="design-creature-section" class="narrative-section">
            <div class="content-box">
                <h2 class="text-4xl font-bold">اصنع مخلوقك</h2>
                <p class="mt-4">هنا تبدأ قصة رفيقك الخاص.</p>
            </div>
        </section>

        <section id="journey-start-section" class="narrative-section">
             <div class="content-box">
                <h2 class="text-4xl font-bold">بداية الرحلة</h2>
                <p class="mt-4">استكشف العوالم المختلفة.</p>
            </div>
        </section>
        
        <section id="city-section" class="narrative-section">
            <div class="content-box">
                <h2 class="text-4xl font-bold">عالم المدينة</h2>
                <p class="mt-2" id="city-creatures-list">مخلوقات هذا العالم...</p>
            </div>
        </section>
        <section id="forest-section" class="narrative-section">
            <div class="content-box">
                <h2 class="text-4xl font-bold">عالم الغابة</h2>
                <p class="mt-2" id="forest-creatures-list">مخلوقات هذا العالم...</p>
            </div>
        </section>
        <section id="snow-section" class="narrative-section">
            <div class="content-box">
                <h2 class="text-4xl font-bold">عالم الثلج</h2>
                <p class="mt-2" id="snow-creatures-list">مخلوقات هذا العالم...</p>
            </div>
        </section>
        <section id="desert-section" class="narrative-section">
            <div class="content-box">
                <h2 class="text-4xl font-bold">عالم الصحراء</h2>
                 <p class="mt-2" id="desert-creatures-list">مخلوقات هذا العالم...</p>
            </div>
        </section>

        <section class="narrative-section">
            <div class="content-box">
                <h2 class="text-4xl font-bold">نهاية الرحلة؟</h2>
                <p class="mt-4">أم بدايتها...</p>
            </div>
        </section>
    </div>

<script>
    // --- SUPABASE SETUP ---
    const SUPABASE_URL = 'https://ntnmbfdhxbclvgplbijw.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im50bm1iZmRoeGJjbHZncGxiaWp3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY1ODk1MTQsImV4cCI6MjA3MjE2NTUxNH0.RLtF1R-bFQ';
    const supabase = Supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // --- THREE.JS SCENE SETUP ---
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ canvas: document.querySelector('.three-canvas') });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    camera.position.z = 5;

    // --- DATA FETCHING & UI POPULATION ---
    async function populateCreatureData() {
        const { data, error } = await supabase.from('creatures').select('common_name, environment');
        if (error) {
            console.error("Error fetching data:", error);
            return;
        }

        const creaturesByBiome = {
            المدينة: [], // Assuming "اليابسة" can be mapped to different biomes
            الغابة: [],
            الثلج: [],
            الصحراء: []
        };
        
        // Simple mapping based on known creatures, can be improved with more data
        data.forEach(c => {
            if (['القطط', 'الكلاب'].some(type => c.common_name.includes(type))) {
                creaturesByBiome.المدينة.push(c.common_name);
            } else if (['المكاو', 'السرعوف'].some(type => c.common_name.includes(type))) {
                creaturesByBiome.الغابة.push(c.common_name);
            } else if (c.common_name.includes('الهاسكي')) {
                 creaturesByBiome.الثلج.push(c.common_name);
            } else if (['التنين الملتحي', 'ليوبارد جيكو'].some(type => c.common_name.includes(type))) {
                 creaturesByBiome.الصحراء.push(c.common_name);
            }
        });

        document.getElementById('city-creatures-list').textContent = creaturesByBiome.المدينة.join('، ');
        document.getElementById('forest-creatures-list').textContent = creaturesByBiome.الغابة.join('، ');
        document.getElementById('snow-creatures-list').textContent = creaturesByBiome.الثلج.join('، ');
        document.getElementById('desert-creatures-list').textContent = creaturesByBiome.الصحراء.join('، ');
    }


    // --- GSAP SCROLL-BASED ANIMATIONS ---
    function setupAnimations() {
        gsap.registerPlugin(ScrollTrigger);

        // --- NEW: Journey Icons Animation ---
        const iconsContainer = document.getElementById('journey-icons-container');
        const icons = gsap.utils.toArray('.journey-icon');

        // Show the icon container after the intro section
        ScrollTrigger.create({
            trigger: "#design-creature-section",
            start: "top center",
            onEnter: () => gsap.to(iconsContainer, { opacity: 1, duration: 0.5 }),
            onLeaveBack: () => gsap.to(iconsContainer, { opacity: 0, duration: 0.5 }),
        });

        // Animate each icon based on its section
        icons.forEach(icon => {
            const sectionId = icon.getAttribute('href');
            ScrollTrigger.create({
                trigger: sectionId,
                start: "top center",
                end: "bottom center",
                onToggle: self => {
                    if (self.isActive) {
                        icon.classList.add('active');
                    } else {
                        icon.classList.remove('active');
                    }
                }
            });
        });


        // --- Existing 3D Scene Animations (Simplified Example) ---
        // Big Bang Effect
        const bigBangTl = gsap.timeline({
            scrollTrigger: {
                trigger: '#big-bang-section',
                scrub: 1,
                start: 'top top',
                end: 'bottom top'
            }
        });
        // You would add 3D animations here, for example:
        // bigBangTl.to(camera.position, { z: 20 });
        
        // Biome transitions
        // This is where you would change the 3D background for each section
        const biomes = ['city', 'forest', 'snow', 'desert'];
        biomes.forEach(biome => {
            ScrollTrigger.create({
                trigger: `#${biome}-section`,
                start: 'top center',
                end: 'bottom center',
                onEnter: () => console.log(`Entering ${biome} biome`),
                onEnterBack: () => console.log(`Entering ${biome} biome`),
                // Add function calls here to change the 3D scene
            });
        });
    }

    // --- MAIN APP INITIALIZATION ---
    function init() {
        // Initial render loop for Three.js
        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }
        animate();

        // Handle window resizing
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Fetch data and setup animations
        populateCreatureData();
        setupAnimations();
    }

    window.onload = init;
</script>
</body>
</html>
